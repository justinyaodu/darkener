{
  "macros":
  [
    [
      "DCONTRAST",
      "brightness(0.5) contrast(var(--dkn-dcontrast, 1)) brightness(2)",
      "Adjust contrast between dark colors."
    ],
    [
      "INVERT",
      "invert() hue-rotate(180deg)",
      "Invert brightness while preserving hue."
    ]
  ],
  "templates":
  [
    [
      "BLACK",
      "ARG_1 { background: black !important; }",
      "Set the background of the selected elements to black."
    ],
    [
      "INVERT",
      "ARG_1 { filter: INVERT; } ARG_1 iframe, ARG_1 img, ARG_1 svg, ARG_1 video { filter: INVERT; }",
      "Invert the selected elements. Also uninvert any nested iframes, images, and videos."
    ],
    [
      "UNINVERT",
      "ARG_1 { filter: INVERT; } ARG_1 iframe, ARG_1 img, ARG_1 svg, ARG_1 video { filter: none; }",
      "Undo an INVERT on a parent element."
    ],
    [
      "INVERT_DCONTRAST",
      "ARG_1 { filter: INVERT DCONTRAST; } ARG_1 iframe, ARG_1 img, ARG_1 svg, ARG_1 video { filter: INVERT; }"
    ]
  ],
  "rules":
  [
    {
      "regex": "^https://www\\.amazon\\.com",
      "macros":
      [
        ["HEADER", "header"],
        ["HMENU", "#hmenu-canvas", "Top left hamburger menu."],
        ["SEARCH_BOX", "#nav-search"],
        ["SEARCH_DROPDOWN", "#nav-flyout-searchAjax", "Search box dropdown."],
        ["FLYOUTS", "#nav-flyout-anchor", "Parent element for navbar flyouts."],
        ["FOOTER", "#navFooter"]
      ],
      "customStyles":
      [
        "BLACK(body)",
        "/* Header's siblings: children of container on main page, children of body on bestsellers page. */",
        "INVERT(HEADER ~ *:not(FOOTER))",
        "INVERT(HMENU)",
        "SEARCH_BOX, SEARCH_DROPDOWN { filter: INVERT; }",
        "INVERT(FLYOUTS)",
        "FOOTER { --dkn-dcontrast: 1.2; filter: DCONTRAST; }"
      ]
    },
    {
      "regex": "^https://www\\.desmos\\.com/calculator",
      "macros":
      [
        ["GRAPH_BACKGROUND", ".dcg-sliding-interior"],
        ["GRAPH_CONTAINER", "#graph-container"],
        ["SIDEBAR", "#mygraphs-container", "Graphs sidebar on left side."],
        ["SIDEBAR_PREVIEW", ".graph-preview"],
        ["THUMBNAIL", ".dcg-thumb"],
        ["MODAL_SAVE", ".dcg-state-modals", "Save modal dialog (click graph name while logged in)."],
        ["MODAL_OTHER", ".dcg-shared-modal", "Other modal dialogs (e.g. login)."],
        ["HEADER", "#dcg-header-container"],
        ["POPOVER", ".dcg-popover", "Popover menus (e.g. top right header buttons, + button at top left of expression sidebar)."],
        ["GRAPH_FILTER", "--dkn-dcontrast: 0.95; filter: INVERT DCONTRAST saturate(1.5);"]
      ],
      "customStyles":
      [
        "GRAPH_CONTAINER, SIDEBAR_PREVIEW, SIDEBAR THUMBNAIL { GRAPH_FILTER }",
        "/* When top left menu is active, opacity of graph screen is decreased: darken background. */",
        "BLACK(GRAPH_BACKGROUND)",
        "INVERT(HEADER POPOVER)",
        "INVERT(MODAL_SAVE)",
        "INVERT(MODAL_OTHER)",
        "/* Disable animation so that modals are inverted immediately. */",
        "MODAL_SAVE, MODAL_OTHER { animation: none !important; }"
      ]
    },
    {
      "regex": "^https://github\\.com",
      "macros":
      [
        ["HEADER", ".js-header-wrapper"],
        ["DROPDOWN", ".dropdown-menu"],
        ["HEADER_SEARCH", ".header-search"]
      ],
      "customStyles":
      [
        "BLACK(body)",
        ":root { --dkn-dcontrast: 0.98; }",
        "INVERT_DCONTRAST(body > *:not(HEADER))",
        "INVERT(HEADER DROPDOWN)",
        "/*",
        "Header search box uses inline !important styles, which can't be overridden.",
        "It also can't be properly inverted when unfocused, since it is partly transparent.",
        "*/",
        "HEADER_SEARCH[aria-expanded=true] { filter: INVERT; z-index: 9999; }"
      ]
    },
    {
      "regex": "^https://[^/]+\\.google\\.com",
      "customStyles":
      [
        "BLACK(html)",
        "INVERT(body)"
      ],
      "rules":
      [
        {
          "regex": "^https://www\\.google\\.com/maps",
          "macros":
          [
            ["PREVIEW", ".full-screen", "Preview before map finishes loading."],
            ["APP", "#app-container"],
            ["APP_SATELLITE", "APP.app-imagery-mode", "App container in satellite view."],
            ["MAP", "#scene"],
            ["SEARCH_ICON", ".searchbox-icon"]
          ],
          "customStyles":
          [
            "PREVIEW img { filter: none; }",
            "/* Sometimes the height is set to 0px, or the width doesn't update on window resize. */",
            "html, body { width: 100% !important; height: 100% !important; }",
            "/* Uninvert the map when in satellite view. */",
            "APP_SATELLITE MAP { filter: INVERT; }",
            "SEARCH_ICON { filter: none; }"
          ]
        },
        {
          "regex": "^https://docs\\.google\\.com/(document|presentation|spreadsheets|forms)",
          "macros":
          [
            ["TEMPLATES", ".docs-homescreen-templates-templateview-preview", "Document template preview bar."]
          ],
          "customStyles":
          [
            "/* Do not uninvert document template preview images. */",
            "TEMPLATES img { filter: none; }"
          ],
          "rules":
          [
            {
              "regex": "^https://docs\\.google\\.com/forms",
              "comment": "Set a white background, which is inverted to black.",
              "customStyles": ["body { background: white !important; }"]
            }
          ]
        },
        {
          "regex": "^https://drive\\.google\\.com",
          "macros":
          [
            ["THUMBNAIL", "img[src^=\"https://lh3.google.com\"]", "File preview thumbnails."],
            ["QA_DOC_FILE", ".g5SSAf", "Non-image file in Quick Access."],
            ["MAIN_FILE", "div[role=gridcell]", "A file in the main view."],
            ["MAIN_IMAGE_FILE", "MAIN_FILE[aria-label$=Image]", "An image file in the main view."],
            ["MAIN_VIDEO_FILE", "MAIN_FILE[aria-label$=Video]", "A video file in the main view."],
            ["PREVIEW_POPUP", "[role=dialog]", "Preview pop-up (for viewing images, etc.)."]
          ],
          "customStyles":
          [
            null,
            "INVERT(body > *:not(PREVIEW_POPUP))",
            "/* Improve icon visibility. */",
            "body > *:not(PREVIEW_POPUP) svg { filter: none; }",
            "/* Quick Access: do not uninvert thumbnails of documents. */",
            "QA_DOC_FILE THUMBNAIL { filter: none; }",
            "/* Files: only uninvert thumbnails of images and videos. */",
            "MAIN_FILE THUMBNAIL { filter: none; }",
            "MAIN_IMAGE_FILE THUMBNAIL, MAIN_VIDEO_FILE THUMBNAIL { filter: INVERT; }"
          ]
        },
        {
          "regex": "^https://mail\\.google\\.com",
          "comment": "Enable Gmail's dark theme as well.",
          "macros":
          [
            ["LOADING", "#loading", "Loading screen."],
            ["MAIL", "[role=main]:not(.BltHke)", "Mail contents."],
            ["COMPOSE", ".aaZ", "Compose window."],
            ["COMPOSE_CONTENT", ".aoI", "Compose window contents."],
            ["POPUP", "[role=menu][aria-haspopup=true]", "Popup menu (for font selection, color, etc.)."],
            ["LISTBOX", "[role=listbox]", "Recipient suggestion listbox."],
            ["QUICK_SETTINGS", ".IU.nn", "Quick settings sidebar."],
            ["ACCOUNT_MENU", "[aria-label=\"Account Information\"]", "Accounts menu in top right."],
            ["SIDEBAR_CONTAINER", ".brB-brH.brC-avC-J4-avO[role=tabpanel]", "Containers for calendar, notes, etc. in right sidebar."],
            ["SIDEBAR_LOADING_HEADER", ".brC-brG-avC.brC-brG-avC-bta-atM", "Header displayed before sidebar iframe loads."],
            ["SIDEBAR_LOADING_MAIN", "SIDEBAR_CONTAINER :nth-child(2) :nth-child(2)", "Loading screen for sidebar iframe."]
          ],
          "customStyles":
          [
            null,
            "INVERT(LOADING)",
            "INVERT(MAIL)",
            "BLACK(COMPOSE)",
            "INVERT(COMPOSE_CONTENT)",
            "POPUP { filter: INVERT; }",
            "INVERT(LISTBOX)",
            "INVERT(QUICK_SETTINGS)",
            "INVERT(ACCOUNT_MENU)",
            "SIDEBAR_LOADING_HEADER { filter: INVERT; }",
            "INVERT(SIDEBAR_LOADING_MAIN)"
          ]
        },
        {
          "regex": "^https://ogs\\.google\\.com",
          "comment": "Apps menu iframe (found in Gmail, Google Drive, etc. at top right).",
          "macros":
          [
            ["APP_ICON", ".MrEfLc"]
          ],
          "customStyles":
          [
            "/* Do not set black background: preserve iframe transparency. */",
            null,
            "INVERT(body)",
            "APP_ICON { filter: INVERT; }"
          ]
        }
      ]
    },
    {
      "regex": "https://developer\\.mozilla\\.org",
      "macros":
      [
        ["CONTAINER", "#react-container"],
        ["FOOTER", "#nav-footer"]
      ],
      "customStyles":
      [
        "BLACK(html)",
        ":root { --dkn-dcontrast: 0.95; }",
        "INVERT_DCONTRAST(CONTAINER > :not(FOOTER))",
        "/* Preserve header icon contrast. */",
        "header svg { filter: none !important; }"
      ]
    },
    {
      "regex": "^https://([^/]+\\.stackexchange.com|askubuntu\\.com|mathoverflow\\.net|(meta\\.)?stackoverflow\\.com|superuser\\.com)",
      "macros":
      [
        ["TOP_BAR", ".top-bar"],
        ["TOP_BAR_DIALOG", ".topbar-dialog"],
        ["SIGN_UP_BANNER", ".js-dismissable-hero"],
        ["COOKIE_BANNER", "#js-gdpr-consent-banner"],
        ["FOOTER", "#footer"],
        ["INVERT_COMMON", ":not(COOKIE_BANNER)"]
      ],
      "customStyles":
      [
        "BLACK(body)",
        "INVERT(body > TO_INVERT)"
      ],
      "rules":
      [
        {
          "regex": "^https://(meta\\.)?stackoverflow\\.com",
          "customStyles":
          [
            "INVERT(body > INVERT_COMMON:not(FOOTER))"
          ]
        },
        {
          "regex": "",
          "customStyles":
          [
            "INVERT(body > INVERT_COMMON:not(SIGN_UP_BANNER):not(TOP_BAR))",
            "INVERT(TOP_BAR_DIALOG)"
          ]
        }
      ]
    },
    {
      "regex": "^https://[^.]+\\.wikipedia.org",
      "macros":
      [
        ["HEADER", "#mw-page-base"],
        ["MATH", ".mwe-math-element"]
      ],
      "customStyles":
      [
        "BLACK(html)",
        ":root { --dkn-dcontrast: 0.95; }",
        "INVERT_DCONTRAST(body)",
        "/* Do not uninvert equations. */",
        "MATH img { filter: none; }",
        "/* Fix inconsistent background in left sidebar. */",
        "body, HEADER { background: transparent; }"
      ]
    },
    {"regex": "^https://bugzilla\\.mozilla\\.org"},
    {"regex": "^https://www\\.facebook\\.com"},
    {"regex": "^https://imgur\\.com"},
    {"regex": "^https://www\\.netflix\\.com"},
    {"regex": "^https://www\\.reddit\\.com"},
    {"regex": "^https://app\\.slack\\.com"},
    {"regex": "^https://www\\.youtube\\.com"}
  ]
}
